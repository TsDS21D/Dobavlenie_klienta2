<!--
calculator/templates/calculator/index.html
Главная страница калькулятора типографии с новой структурой:
1. Список всех просчётов (новая секция)
2. Главный блок "Просчёт" с вложенными секциями
Теперь наследует новый самостоятельный base.html
-->

{% extends "calculator/base.html" %}

{% block title %}Калькулятор типографии{% endblock %}

{% block extra_css %}
{{ block.super }}
{% load static %}

<!-- Подключаем CSS для новой секции ВЫЧИСЛЕНИЙ ЛИСТОВ -->
<link rel="stylesheet" href="{% static 'vichisliniya_listov/css/sections/vichisliniya_listov.css' %}">
<!-- Подключаем CSS для новой секции -->
<link rel="stylesheet" href="{% static 'calculator/css/sections/list_proschet.css' %}">
<link rel="stylesheet" href="{% static 'calculator/css/sections/proschet.css' %}">
<link rel="stylesheet" href="{% static 'calculator/css/sections/product.css' %}">
<link rel="stylesheet" href="{% static 'calculator/css/sections/client.css' %}">
<link rel="stylesheet" href="{% static 'calculator/css/sections/print_components.css' %}">
<link rel="stylesheet" href="{% static 'calculator/css/sections/additional_works.css' %}">
<link rel="stylesheet" href="{% static 'calculator/css/sections/price.css' %}">
{% endblock %}

{% block content %}
    <h1>
        <img src="https://www.bukva-a.ru/uploads/logo/logo300.png" 
            alt="Типография &quot;Буква А&quot;" 
            title="Типография &quot;Буква А&quot;"
            width="150">
        Калькулятор типографии
    </h1>
    
    <div class="django-messages" style="display: none;">
        {% if messages %}
            {% for message in messages %}
                <div class="django-message" data-type="{{ message.tags }}">
                    {{ message }}
                </div>
            {% endfor %}
        {% endif %}
    </div>
    
    <!-- ОСНОВНОЙ КОНТЕЙНЕР С СЕКЦИЯМИ -->
    <div class="calculator-sections">
        
        <!-- ===== НОВАЯ СЕКЦИЯ: СПИСОК ВСЕХ ПРОСЧЁТОВ ===== -->
        {% include "calculator/sections/list_proschet.html" %}
        
        <!-- ===== ГЛАВНАЯ СЕКЦИЯ: ПРОСЧЁТ ===== -->
        <div class="calculator-section main-section" id="section-proschet">
            <div class="section-header">
                <h2>
                    <span class="section-number">2</span> 
                    Просчёт
                </h2>
                <div class="header-buttons">
                    <button class="btn-action btn-calculate-price" 
                            title="Рассчитать цену"
                            onclick="calculateTotalPrice()">
                        <i class="fas fa-calculator"></i> Рассчитать
                    </button>
                    <button class="btn-action btn-collapse-section" 
                            data-target="section-proschet" 
                            title="Свернуть/развернуть секцию">
                        <i class="fas fa-chevron-down"></i>
                    </button>                    
                </div>
            </div>
            
            <div class="section-body">
                <div class="nested-sections">
                    
                    <div class="nested-row">
                        <div class="nested-col" data-col-size="half">
                            {% include "calculator/sections/client.html" %}
                        </div>
                        <div class="nested-col" data-col-size="half">
                            {% include "calculator/sections/product.html" %}
                        </div>
                    </div>
                    
                    <!-- ===== НОВАЯ СЕКЦИЯ: ВЫЧИСЛЕНИЯ ЛИСТОВ ===== -->
                    <div class="nested-row">
                        <div class="nested-col" data-col-size="full">
                            <!-- Подключаем секцию вычислений листов из нового приложения -->
                            <!-- Обновляем номер секции на 3 (так как она третья по счету) -->
                            {% with section_number=3 %}
                                {% include "vichisliniya_listov/sections/vichisliniya_listov.html" %}
                            {% endwith %}
                        </div>
                    </div>



                    <div class="nested-row">
                        <div class="nested-col" data-col-size="full">
                            {% include "calculator/sections/print_components.html" %}
                        </div>
                    </div>
                    
                    <div class="nested-row">
                        <div class="nested-col" data-col-size="full">
                            {% include "calculator/sections/additional_works.html" %}
                        </div>
                    </div>
                    
                    <div class="nested-row">
                        <div class="nested-col" data-col-size="full">
                            {% include "calculator/sections/price.html" %}
                        </div>
                    </div>
                    
                </div>
            </div>
        </div>
        
    </div>
{% endblock %}

{% block extra_js %}
{{ block.super }}
{% load static %}
<!-- Подключаем JavaScript для новой секции ВЫЧИСЛЕНИЙ ЛИСТОВ -->
<script src="{% static 'vichisliniya_listov/js/sections/vichisliniya_listov.js' %}"></script>

<!-- Подключаем JavaScript для всех секций -->
<script src="{% static 'calculator/js/sections/product.js' %}"></script>
<script src="{% static 'calculator/js/sections/list_proschet.js' %}"></script>
<script src="{% static 'calculator/js/sections/print_components.js' %}"></script>
<script src="{% static 'calculator/js/sections/list_proschet_inline_edit.js' %}"></script>
<script src="{% static 'calculator/js/sections/proschet.js' %}"></script>
<script src="{% static 'calculator/js/sections/proschet_inline_edit.js' %}"></script>
<script src="{% static 'calculator/js/sections/client.js' %}"></script>

<!-- Модуль inline-редактирования клиента -->
<script src="{% static 'calculator/js/sections/client_inline_edit.js' %}"></script>

<script src="{% static 'calculator/js/sections/product_inline_edit.js' %}"></script>
<script src="{% static 'calculator/js/circulation_change_handler.js' %}"></script>
<script src="{% static 'calculator/js/sections/print_components_inline_edit.js' %}"></script>
<script src="{% static 'calculator/js/sections/additional_works.js' %}"></script>
<script src="{% static 'calculator/js/sections/price.js' %}"></script>
{% endblock %}